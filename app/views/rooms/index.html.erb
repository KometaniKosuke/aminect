<h2>Talk</h2>

<% if @rooms.count==0 %>
  <p>友達をフォローしてトークを開始しよう！</p>
<% else %>
  <% wd=["日","月","火","水","木","金","土"] %>
  <% @rooms.each do |id| %>
    <% room = Room.find(id) %>
    <% urs = UserRoom.where(room_id: room.id) %>
    <% talker = urs.where.not(user_id: current_user.id) %>
    <% talker = User.find_by(id: talker.first.user_id) %>
    <%= link_to room, :class=>"rooms" do %>
      <table style="width: 100%; height: 10%;">
        <td style="width: 20%;"><%= image_tag talker.image.url, size:"65x65",class:"rounded-circle" %></td>
        <td>
          <table style="width: 98%; text-align: left; table-layout: fixed;">
            <% massage = Message.where(room_id: room.id).last %>
            <tr>
              <th style="font-weight: bold"><%= talker.name %></th>
              <td style="width: 10%;">
                <% if massage.present? %>
                  <% if massage.date.strftime("%y/%-m/%-d")==Time.current.strftime("%y/%-m/%-d") %>
                    <%= massage.date.strftime("%-H:%M") %>
                  <% else %>
                    <%= massage.date.strftime("%-m/%-d") %>
                  <% end %>
                <% end %>
              </td>
            </tr>
            <tr>
              <td style="padding: 0 2%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                <% if massage.present? %>
                  <%= massage.text %>
                <% else %>
                  <% m="　" %><%= m %>
                <% end %>
              </td>
            </tr>
          </table>
        </td>
      </table>
    <% end %>
    <hr style="border: none; border-bottom: 1px solid #333; margin: 0;">
  <% end %>
<% end %>
